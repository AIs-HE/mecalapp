version: '3.8'
services:
  web:
    build: .
    image: mecalapp_web:latest
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      NEXT_PUBLIC_SUPABASE_URL: "https://mkabjugldwhkvxyczvoh.supabase.co"
      NEXT_PUBLIC_SUPABASE_ANON_KEY: "REPLACE_WITH_ANON_KEY"
      # Do NOT set SUPABASE_SERVICE_ROLE_KEY here if this compose is used for public/container deployment
      # The service role key should be set via Container Station UI as a container environment variable (secret)
    volumes:
      - ./:/app:ro
    deploy:
      resources:
        limits:
          memory: 1024M

  nginx:
    image: nginx:stable-alpine
    restart: unless-stopped
    ports:
      - "80:80"
    volumes:
      - ./deploy/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - web
